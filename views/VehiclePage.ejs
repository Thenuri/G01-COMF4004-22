<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/css/syntax1.css">
    <link rel="stylesheet" type="text/css" href="/css/commonstyles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div>
        <header>
            <!--nav bar-->
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark p-md-3">
                <div class="container">
                    <a href="/" class="navbar-brand text-white fs-1 fw-bold">Book My Bus</a>
                    <button type="button"class="navbar-toggler"data-bs-target="#navbarNav"data-bs-toggle="collapse"aria-controls="navbarNav"aria-expanded="false"aria-label="Toggle Navbar">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <div class="mx-auto"></div>
                        <ul class="navbar-nav   fs-5">
                            <li class="nav-item mx-4 my-auto"><a href="/vehicle" class="nav-link text-white">Book Now</a></li>
                            <li class="nav-item mx-4 my-auto"><a href="/#aboutUs" class="nav-link text-white">About Us</a></li>
                            <li class="nav-item mx-4 my-auto"><a href="/#ContactUs" class="nav-link text-white">Contact Us</a></li>
                            <%- include('partials/navBarProfileOrSignIn')%>
                        </ul>
                    </div>
                </div>
            </nav>
            <!--main image-->
            <div class="banner1 vw-100 vh-80   justify-content-center align-items-center">
                <div class="content text-right ">
                    <h1 class="text-white" id="h1text2">Vehicles</h1>
                </div>
            </div>
        </header>
    </div>
    <br><br><br><br><br><br><br>
    <div class="form-container1" >
        <form action="">
            <!--<div class="input-box">
                <span>To</span>
                <input type="search" name="" id="to" placeholder="search place">
            </div>
            <div class="input-box">
                <span>From</span>
                <input type="search" name="" id="from" placeholder="search place">
            </div>-->
            <div class="input-box">
                <span>Start Date</span>
                <input type="date" name="" id="start_Date">
            </div>
            <div class="input-box">
                <span>Return Date</span>
                <input type="date" name="" id="return_Date">

            </div>
            <div id="dropdown" >
                <div class="dropdown">
                    <!--<div class="select">
                        <span class="selected">50 Seats</span>
                        <div class="caret"></div>     
                    </div>
                    <ul class="menu">
                        <li>40 Seats</li>
                        <li>30 seats</li>
                        <li>20 seats</li>
                        <li class="active">50 Seats</li>
                    </ul>-->
                    <select name="seats" id="seats" class="form-select">
                        <option value=null selected > No Of Seats</option>
                        <option value="20-30">20 to 30</option>
                        <option value="30-40">30 to 40</option>
                        <option value="40-50">40 to 50</option>
                        <option value="50-60">50 to 60</option>

                    </select>
                </div>
                <div class="dropdown">
                    <!--<div class="select">
                        <span class="selected">Hight to Low</span>
                        <div class="caret"></div>     
                    </div>
                    <ul class="menu">
                        <li>Low to High</li>
                        <li class="active">Hight to Low</li>
                    </ul>-->
                    <select name="price" id="price" class="form-select">
                        <option value="low to high price">Low to High Price</option>
                        <option value="high to low price">High to Low Price</option>
                    </select>

                </div>

            </div>
            <div class="ac" id="accc">
                <select name="ac" id="ac-select" class="form-select" >
                    <option value=null selected >Select Ac Type</option>
                    <option value="ac">AC</option>
                    <option value="non-ac">Non-AC</option>
                </select> 
            </div><br><br>
            <button class="btn" id="filterBtn">filter</button>
           
        </form>
    </div>
    <br><br><br><br>
    
    <div class="vehicles d-flex flex-wrap" id="buses">
    <!--     <div class="dashboard-content p-4" style="margin-top: 3rem;">
            <div id="upcoming-trips-items">
                <div class="trip-info-card card overflow-hidden border-0fs-5" style="background-color: #bbc4de; border-radius: 20px; width:400px;height:250px;">
                    <div class="trip-card-grid">
                        <div class="trip-info-bus-img" style="background-image: url('/images/jonathan-borba-T5jzpRTVF1U-unsplash.jpg');" > </div>
                        <div class=" justify-content-around  fw-bold">
                            <div class="row px-3">
                                <div class="col-0 text-start" id="text">NA-1323 <br>LKR/KM-LKR 240.00<br>
                                   <img src="images/ic_airline_seat_recline_extra_24px.svg" class="seat-icon"><span>50</span> <span id="ac">AC</span>
                                   <div class=" rating-stars d-flex" style="font-size:30px;">
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star-o"> </span>
                                </div><br><br>
                                   <button type="button" class="btn" id="btn1">Book</button>
                                </div>
                            </div>                    
                        </div>
                    </div>  
                </div>
            </div>
        </div>  
        <div class="dashboard-content p-4" style="margin-top: 3rem;">
            <div id="upcoming-trips-items">
                <div class="trip-info-card card overflow-hidden border-0fs-5" style="background-color: #bbc4de; border-radius: 20px; width:400px; height:250px;">
                    <div class="trip-card-grid">
                        <div class="trip-info-bus-img" style="background-image: url('/images/istockphoto-1372188593-170667a.jpg');" > </div>
                        <div class=" justify-content-around  fw-bold">
                            <div class="row px-3">
                                <div class="col-0 text-start" id="text">NA-1458<br>LKR/KM-LKR 270.00<br>
                                   <img src="images/ic_airline_seat_recline_extra_24px.svg" class="seat-icon"><span>30</span> <span id="ac">AC</span>
                                   <div class=" rating-stars d-flex" style="font-size:30px;">
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star-o"> </span>
                                </div><br><br>
                                   <button type="button" class="btn" id="btn1">Book</button>
                                </div>
                            </div>                    
                        </div>
                    </div>  
                </div>
            </div>
        </div>  
        <div class="dashboard-content p-4" style="margin-top: 3rem;">
            <div id="upcoming-trips-items">
                <div class="trip-info-card card overflow-hidden border-0fs-5" style="background-color: #bbc4de; border-radius: 20px;width:400px; height:250px;">
                    <div class="trip-card-grid">
                        <div class="trip-info-bus-img" style="background-image: url('/images/istockphoto-1214119696-612x612.jpg');" > </div>
                        <div class=" justify-content-around  fw-bold" >
                            <div class="row px-3">
                                <div class="col-0 text-start" id="text">NA-1321 <br>LKR/KM-LKR 250.00<br>
                                   <img src="images/ic_airline_seat_recline_extra_24px.svg" class="seat-icon" id="seat"><span>50</span> <span id="ac"> NoN/AC</span>
                                   <div class=" rating-stars d-flex" style="font-size:30px;">
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star"></span>
                                    <span class="fa fa-star-o"> </span>
                                </div><br><br>
                                   <button type="button" class="btn" id="btn1">Book</button>
                                </div>
                            </div>                    
                        </div>
                    </div>  
                </div>
            </div>
        </div> 
             -->
    </div>



    
    <footer>
        <p class="copyright">
             &copy;  2022 Book My Bus. 
        </p>
    </footer>


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    <script>
        let navbar = document.querySelector('nav');
        window.addEventListener('scroll',scroll)
        function scroll(){
            if(window.pageYOffset>100){
            //   navbar.classList.add('bg-primary','shadow');  
              navbar.classList.add('bg-dark-blue-theme','shadow');  

            }else{
                navbar.classList.remove('bg-dark-blue-theme','shadow');
            }
        }

    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded",filtering )

        document.getElementById("filterBtn").addEventListener("click",filtering);
        
        function filtering(event){
            event.preventDefault();
           /* let To = document.getElementById("to").value;
            let From = document.getElementById("from").value;*/
            let start_Date = document.getElementById("start_Date").value;
            let return_Date = document.getElementById("return_Date").value;
            let seatNo = document.getElementById("seats").value;
            let ac = document.getElementById("ac-select").value;
            let price = document.getElementById("price").value;
            let filterValues = {
                /*to : To,
                From :From,*/
                ac : ac,
                start_Date : start_Date,
                return_Date : return_Date,
                seatNo : seatNo,
                price : price
            }
           /* console.log(filterValues);*/
            axios.post('http://localhost:3000/vehicle/finder', filterValues)
            .then( (res) => {
              /*  console.log(res)*/
                buses = res.data /* getting the bus array*/ 
              /*  console.log(buses)*/
                displayBuses(buses);
            }).catch(e => console.log(e))
            
        }

        function displayBuses(buses) {
            let busesContainerElement = document.getElementById("buses");
            busesContainerElement.innerHTML = ""
            buses.forEach( bus => {
                let ratingStarsHTML ="";
                for (let i = 0; i < 5; i++) {

                    if ( i < Math.floor(bus.Rating)) {
                        ratingStarsHTML += `<span class="fa fa-star"></span>`
                    } else  {
                        ratingStarsHTML += `<span class="fa fa-star-o"></span>`
                    }
                }
                

                busCard = `
                <div class="dashboard-content p-4" style="margin-top: 3rem;">
                    <div id="upcoming-trips-items">
                        <div class="trip-info-card card overflow-hidden border-0fs-5" style="background-color: #bbc4de; border-radius: 20px; width:400px; height:250px;">
                            <div class="trip-card-grid">
                                <div class="trip-info-bus-img" style="background-image: url('${bus.Bus_Image}');" > </div>
                                <div class=" justify-content-around  fw-bold">
                                    <div class="row px-3">
                                        <div class="col-0 text-start" id="text">${bus.Bus_No.toUpperCase()}<br>LKR/KM-${bus.Price_Per_km}.00<br>
                                        <img src="images/ic_airline_seat_recline_extra_24px.svg" class="seat-icon"><span>${bus.No_Of_Seats}</span> <span id="ac">${bus.AC_Status.toUpperCase()}</span>
                                        <div class=" rating-stars d-flex" style="font-size:30px;">
                                            ${ratingStarsHTML}
                                        </div>
                                        <div>${bus.Rating.toFixed(1)} / 5.0  (${bus.No_Of_Ratings})</div> 
                                        <br>                                                                            
                                        <a href="/vehicle/${bus.Bus_ID}"><button type="button" class="btn" id="btn1">Book</button></a>
                                        </div>
                                    </div>                    
                                </div>
                            </div>  
                        </div>
                    </div>
                </div>  ` 
           /* console.log('buscard', busCard)*/
            busesContainerElement.innerHTML += busCard;
            }) ;  
        }

        // Blocking the previous days
        document.addEventListener("DOMContentLoaded", olddate)
        function olddate(){
            let startDate = document.getElementById("start_Date").value;
            let returnDate = document.getElementById("return_Date").value;
            let today = new Date().toISOString().split("T")[0];
            document.getElementById('start_Date').setAttribute('min', today);
            document.getElementById('return_Date').setAttribute('min', today);
        }

    </script>
</body>
</html>
